<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.review.front.frontAppoint.mapper.AppointExpertMapper">
    <select id="getReviewExpertCalendars" parameterType="Long" resultType="com.review.manage.expert.vo.ReviewExpertCalendarVo">
        SELECT
            c.id,
            c.expert_id expertId,
            c.week_day weekDay,
            CASE
                c.week_day
                WHEN '1' THEN
                    '周一'
                WHEN '2' THEN
                    '周二'
                WHEN '3' THEN
                    '周三'
                WHEN '4' THEN
                    '周四'
                WHEN '5' THEN
                    '周五'
                WHEN '6' THEN
                    '周六'
                WHEN '0' THEN
                    '周日'
                END weekDayName,
            c.STATUS,
            c.visit_date AS visitDate,
            DATE_FORMAT( c.begin_time, '%H:%i' ) AS beginTime,
            DATE_FORMAT( c.end_time, '%H:%i' ) AS endTime,
            DATE_FORMAT( c.create_time, '%Y-%m-%e %H:%i:%S' ) AS createTime
        FROM
            review_expert_calendar c
        WHERE
            c.expert_id = #{expertId}
          AND c.STATUS = 1
          AND c.visit_date >= DATE_FORMAT( now(), '%Y-%m-%e' )
        ORDER BY
            c.visit_date,
            c.begin_time ASC
    </select>

    <select id="getMyAppointList" parameterType="String" resultType="com.review.front.frontAppoint.vo.ConsultationVO">
        SELECT
            rer.id AS id,
            rer.patient_name AS patientName,
            rec.visit_date AS visitDate,
            rec.begin_time AS beginTime,
            rer.user_id AS userId,
            re.charge AS charge,
            CASE
                rer.confirm_flag
                WHEN 0 THEN
                    '待确认'
                WHEN 1 THEN
                    '已确认'
                END confirmFlag,
            rec.end_time AS endTime,
            ru.mobile_phone AS userPhone
        FROM
            review_expert re,
            review_expert_calendar rec,
            review_expert_reserve rer,
            review_user ru
        WHERE
            re.id = rec.expert_id
          AND rer.calendar_id = rec.id
          AND rer.user_id = ru.user_id
          AND re.mobile_phone = #{expertPhone}
        ORDER BY
            rer.confirm_flag ASC,
            rec.visit_date DESC,
            rec.begin_time ASC
    </select>
</mapper>